import{H as me,I as E,j as e,g as be,a as xe,s as k,m as q,aq as fe,M as O,u as je,al as ee,_ as D,f as Z,h as ve,c as se,P as Se,Z as te,i as X,Y as H,Q as L,L as Pe,k as Be,B as Ce,T as Ie}from"./index-Bm_OlzcE.js";import{r as v}from"./react-vendor-CUI16jnX.js";import{d as m,T as ye,a as Re,b as Te,c as J,e as we,D as De,f as Le,g as Me}from"./TableRow-BOAZ_LaZ.js";import{C as ke}from"./Chip-C67YqGl8.js";import{E as Fe}from"./Edit-7xF3s8qT.js";import{K as $e,a as Ee}from"./KeyboardArrowRight-CdBU-HAQ.js";import{F as Ne,L as Ae}from"./LastPage-D_eWOsAG.js";import{S as ne,b as Ue,T as M,F as We,I as Ge}from"./TextField-DTh0cqUW.js";import{D as ze}from"./DialogTitle-Dqiu5AW8.js";import"./redux-vendor-D3UFojRl.js";const He=v.forwardRef(function(o,r){const{backIconButtonProps:u,count:b,disabled:g=!1,getItemAriaLabel:h,nextIconButtonProps:f,onPageChange:a,page:c,rowsPerPage:j,showFirstButton:I,showLastButton:R,slots:x={},slotProps:i={},...y}=o,d=me(),S=B=>{a(B,0)},T=B=>{a(B,c-1)},N=B=>{a(B,c+1)},F=B=>{a(B,Math.max(0,Math.ceil(b/j)-1))},A=x.firstButton??E,w=x.lastButton??E,$=x.nextButton??E,n=x.previousButton??E,l=x.firstButtonIcon??Ne,s=x.lastButtonIcon??Ae,p=x.nextButtonIcon??$e,W=x.previousButtonIcon??Ee,G=d?w:A,V=d?$:n,z=d?n:$,K=d?A:w,P=d?i.lastButton:i.firstButton,_=d?i.nextButton:i.previousButton,Q=d?i.previousButton:i.nextButton,Y=d?i.firstButton:i.lastButton;return e.jsxs("div",{ref:r,...y,children:[I&&e.jsx(G,{onClick:S,disabled:g||c===0,"aria-label":h("first",c),title:h("first",c),...P,children:d?e.jsx(s,{...i.lastButtonIcon}):e.jsx(l,{...i.firstButtonIcon})}),e.jsx(V,{onClick:T,disabled:g||c===0,color:"inherit","aria-label":h("previous",c),title:h("previous",c),..._??u,children:d?e.jsx(p,{...i.nextButtonIcon}):e.jsx(W,{...i.previousButtonIcon})}),e.jsx(z,{onClick:N,disabled:g||(b!==-1?c>=Math.ceil(b/j)-1:!1),color:"inherit","aria-label":h("next",c),title:h("next",c),...Q??f,children:d?e.jsx(W,{...i.previousButtonIcon}):e.jsx(p,{...i.nextButtonIcon})}),R&&e.jsx(K,{onClick:F,disabled:g||c>=Math.ceil(b/j)-1,"aria-label":h("last",c),title:h("last",c),...Y,children:d?e.jsx(l,{...i.firstButtonIcon}):e.jsx(s,{...i.lastButtonIcon})})]})});function qe(t){return xe("MuiTablePagination",t)}const U=be("MuiTablePagination",["root","toolbar","spacer","selectLabel","selectRoot","select","selectIcon","input","menuItem","displayedRows","actions"]);var oe;const Ve=k(m,{name:"MuiTablePagination",slot:"Root",overridesResolver:(t,o)=>o.root})(q(({theme:t})=>({overflow:"auto",color:(t.vars||t).palette.text.primary,fontSize:t.typography.pxToRem(14),"&:last-child":{padding:0}}))),Ke=k(fe,{name:"MuiTablePagination",slot:"Toolbar",overridesResolver:(t,o)=>({[`& .${U.actions}`]:o.actions,...o.toolbar})})(q(({theme:t})=>({minHeight:52,paddingRight:2,[`${t.breakpoints.up("xs")} and (orientation: landscape)`]:{minHeight:52},[t.breakpoints.up("sm")]:{minHeight:52,paddingRight:2},[`& .${U.actions}`]:{flexShrink:0,marginLeft:20}}))),_e=k("div",{name:"MuiTablePagination",slot:"Spacer",overridesResolver:(t,o)=>o.spacer})({flex:"1 1 100%"}),Qe=k("p",{name:"MuiTablePagination",slot:"SelectLabel",overridesResolver:(t,o)=>o.selectLabel})(q(({theme:t})=>({...t.typography.body2,flexShrink:0}))),Ye=k(ne,{name:"MuiTablePagination",slot:"Select",overridesResolver:(t,o)=>({[`& .${U.selectIcon}`]:o.selectIcon,[`& .${U.select}`]:o.select,...o.input,...o.selectRoot})})({color:"inherit",fontSize:"inherit",flexShrink:0,marginRight:32,marginLeft:8,[`& .${U.select}`]:{paddingLeft:8,paddingRight:24,textAlign:"right",textAlignLast:"right"}}),Ze=k(O,{name:"MuiTablePagination",slot:"MenuItem",overridesResolver:(t,o)=>o.menuItem})({}),Je=k("p",{name:"MuiTablePagination",slot:"DisplayedRows",overridesResolver:(t,o)=>o.displayedRows})(q(({theme:t})=>({...t.typography.body2,flexShrink:0})));function Oe({from:t,to:o,count:r}){return`${t}–${o} of ${r!==-1?r:`more than ${o}`}`}function Xe(t){return`Go to ${t} page`}const et=t=>{const{classes:o}=t;return ve({root:["root"],toolbar:["toolbar"],spacer:["spacer"],selectLabel:["selectLabel"],select:["select"],input:["input"],selectIcon:["selectIcon"],menuItem:["menuItem"],displayedRows:["displayedRows"],actions:["actions"]},qe,o)},tt=v.forwardRef(function(o,r){const u=je({props:o,name:"MuiTablePagination"}),{ActionsComponent:b=He,backIconButtonProps:g,colSpan:h,component:f=m,count:a,disabled:c=!1,getItemAriaLabel:j=Xe,labelDisplayedRows:I=Oe,labelRowsPerPage:R="Rows per page:",nextIconButtonProps:x,onPageChange:i,onRowsPerPageChange:y,page:d,rowsPerPage:S,rowsPerPageOptions:T=[10,25,50,100],SelectProps:N={},showFirstButton:F=!1,showLastButton:A=!1,slotProps:w={},slots:$={},...n}=u,l=u,s=et(l),p=w?.select??N,W=p.native?"option":Ze;let G;(f===m||f==="td")&&(G=h||1e3);const V=ee(p.id),z=ee(p.labelId),K=()=>a===-1?(d+1)*S:S===-1?a:Math.min(a,(d+1)*S),P={slots:$,slotProps:w},[_,Q]=D("root",{ref:r,className:s.root,elementType:Ve,externalForwardedProps:{...P,component:f,...n},ownerState:l,additionalProps:{colSpan:G}}),[Y,B]=D("toolbar",{className:s.toolbar,elementType:Ke,externalForwardedProps:P,ownerState:l}),[ae,le]=D("spacer",{className:s.spacer,elementType:_e,externalForwardedProps:P,ownerState:l}),[re,ie]=D("selectLabel",{className:s.selectLabel,elementType:Qe,externalForwardedProps:P,ownerState:l,additionalProps:{id:z}}),[ce,ue]=D("select",{className:s.select,elementType:Ye,externalForwardedProps:P,ownerState:l}),[de,pe]=D("menuItem",{className:s.menuItem,elementType:W,externalForwardedProps:P,ownerState:l}),[ge,he]=D("displayedRows",{className:s.displayedRows,elementType:Je,externalForwardedProps:P,ownerState:l});return e.jsx(_,{...Q,children:e.jsxs(Y,{...B,children:[e.jsx(ae,{...le}),T.length>1&&e.jsx(re,{...ie,children:R}),T.length>1&&e.jsx(ce,{variant:"standard",...!p.variant&&{input:oe||(oe=e.jsx(Ue,{}))},value:S,onChange:y,id:V,labelId:z,...p,classes:{...p.classes,root:Z(s.input,s.selectRoot,(p.classes||{}).root),select:Z(s.select,(p.classes||{}).select),icon:Z(s.selectIcon,(p.classes||{}).icon)},disabled:c,...ue,children:T.map(C=>v.createElement(de,{...pe,key:C.label?C.label:C,value:C.value?C.value:C},C.label?C.label:C))}),e.jsx(ge,{...he,children:I({from:a===0?0:d*S+1,to:K(),count:a===-1?-1:a,page:d})}),e.jsx(b,{className:s.actions,backIconButtonProps:g,count:a,nextIconButtonProps:x,onPageChange:i,page:d,rowsPerPage:S,showFirstButton:F,showLastButton:A,slotProps:w.actions,slots:$.actions,getItemAriaLabel:j,disabled:c})]})})}),ot=se(e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add"),st=se(e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),nt=t=>{switch(t){case"active":return"success";case"inactive":return"error";case"draft":return"warning";default:return"default"}},at=t=>{switch(t){case"active":return"Активна";case"inactive":return"Неактивна";case"draft":return"Черновик";default:return t}},lt=({games:t,page:o,rowsPerPage:r,onPageChange:u,onRowsPerPageChange:b,onEdit:g,onDelete:h})=>{const f=r-Math.min(r,t.length-o*r);return e.jsxs(e.Fragment,{children:[e.jsx(ye,{component:Se,children:e.jsxs(Re,{children:[e.jsx(Te,{children:e.jsxs(J,{children:[e.jsx(m,{children:"Название"}),e.jsx(m,{children:"Цена"}),e.jsx(m,{children:"Жанр"}),e.jsx(m,{children:"Платформа"}),e.jsx(m,{children:"Статус"}),e.jsx(m,{children:"Действия"})]})}),e.jsxs(we,{children:[t.slice(o*r,o*r+r).map(a=>e.jsxs(J,{children:[e.jsx(m,{children:a.title}),e.jsx(m,{children:a.price?`${a.price} ₽`:"Не указана"}),e.jsx(m,{children:a.genre||"Не указан"}),e.jsx(m,{children:a.platform||"Не указана"}),e.jsx(m,{children:e.jsx(ke,{label:at(a.status),color:nt(a.status),size:"small"})}),e.jsxs(m,{children:[e.jsx(te,{title:"Редактировать",children:e.jsx(E,{onClick:()=>g(a),size:"small",children:e.jsx(Fe,{})})}),e.jsx(te,{title:"Удалить",children:e.jsx(E,{onClick:()=>h(a.id),size:"small",color:"error",children:e.jsx(st,{})})})]})]},a.id)),f>0&&e.jsx(J,{style:{height:53*f},children:e.jsx(m,{colSpan:6})})]})]})}),e.jsx(tt,{component:"div",count:t.length,page:o,onPageChange:u,rowsPerPage:r,onRowsPerPageChange:b,labelRowsPerPage:"Строк на странице:",labelDisplayedRows:({from:a,to:c,count:j})=>`${a}-${c} из ${j!==-1?j:`более чем ${c}`}`})]})},rt=({open:t,onClose:o,formData:r,onInputChange:u,onSubmit:b,selectedGame:g})=>e.jsxs(De,{open:t,onClose:o,maxWidth:"md",fullWidth:!0,children:[e.jsx(ze,{children:g?"Редактировать игру":"Добавить новую игру"}),e.jsxs("form",{onSubmit:b,children:[e.jsxs(Le,{children:[e.jsx(M,{fullWidth:!0,margin:"normal",label:"Название",name:"title",value:r.title,onChange:u,required:!0}),e.jsx(M,{fullWidth:!0,margin:"normal",label:"Описание",name:"description",value:r.description,onChange:u,multiline:!0,rows:4,required:!0}),e.jsx(M,{fullWidth:!0,margin:"normal",label:"Цена",name:"price",type:"number",value:r.price,onChange:u,required:!0}),e.jsx(M,{fullWidth:!0,margin:"normal",label:"Жанр",name:"genre",value:r.genre,onChange:u,required:!0}),e.jsx(M,{fullWidth:!0,margin:"normal",label:"Платформа",name:"platform",value:r.platform,onChange:u,required:!0}),e.jsx(M,{fullWidth:!0,margin:"normal",label:"Издатель",name:"publisher",value:r.publisher,onChange:u,required:!0}),e.jsx(M,{fullWidth:!0,margin:"normal",label:"URL изображения",name:"imageUrl",value:r.imageUrl,onChange:u}),e.jsxs(We,{fullWidth:!0,margin:"normal",children:[e.jsx(Ge,{children:"Статус"}),e.jsxs(ne,{name:"status",value:r.status,onChange:u,label:"Статус",children:[e.jsx(O,{value:"active",children:"Активна"}),e.jsx(O,{value:"inactive",children:"Неактивна"})]})]})]}),e.jsxs(Me,{children:[e.jsx(X,{onClick:o,children:"Отмена"}),e.jsx(X,{type:"submit",variant:"contained",color:"primary",children:g?"Сохранить":"Добавить"})]})]})]}),it=()=>{const[t,o]=v.useState([]),[r,u]=v.useState(!0),[b,g]=v.useState(null),[h,f]=v.useState(!1),[a,c]=v.useState(null),[j,I]=v.useState(0),[R,x]=v.useState(10),[i,y]=v.useState({title:"",description:"",price:"",genre:"",platform:"",publisher:"",imageUrl:"",status:"active"}),d=async()=>{console.log("Fetching games...");try{u(!0),g(null);const n=await H.get("/games");if(console.log("Response:",n.data),n.data.success)o(n.data.data||[]);else throw new Error(n.data.message||"Failed to fetch games")}catch(n){const l=n.response?.data?.message||n.message||"Ошибка при загрузке игр";g(l),L.error(l),console.error("Error fetching games:",n),o([])}finally{u(!1)}};v.useEffect(()=>{d()},[]);const S=(n,l)=>{console.log("Changing page to:",l),I(l)},T=n=>{const l=parseInt(n.target.value,10);console.log("Changing rows per page to:",l),x(l),I(0)},N=(n=null)=>{console.log("Opening dialog for game:",n),n?(y({title:n.title||"",description:n.description||"",price:n.price?.toString()||"",genre:n.genre||"",platform:n.platform||"",publisher:n.publisher||"",imageUrl:n.imageUrl||"",status:n.status||"active"}),c(n)):(y({title:"",description:"",price:"",genre:"",platform:"",publisher:"",imageUrl:"",status:"active"}),c(null)),f(!0)},F=()=>{console.log("Closing dialog"),f(!1),c(null),y({title:"",description:"",price:"",genre:"",platform:"",publisher:"",imageUrl:"",status:"active"})};return{games:t,loading:r,error:b,openDialog:h,selectedGame:a,formData:i,page:j,rowsPerPage:R,handleChangePage:S,handleChangeRowsPerPage:T,handleOpenDialog:N,handleCloseDialog:F,handleInputChange:n=>{const{name:l,value:s}=n.target;console.log(`Changing input ${l} to:`,s),y(p=>({...p,[l]:s}))},handleSubmit:async n=>{n.preventDefault(),console.log("Submitting form with data:",i),console.log("Form Data before submission:",i),console.log("Values of all form fields before submission:"),Object.keys(i).forEach(s=>{console.log(`${s}: ${i[s]}`)}),console.log("Client-side logging: Checking data to be sent to server..."),console.log("Data to be sent:",i);const l=parseFloat(i.price);if(isNaN(l)||l<=0){const s="Цена должна быть положительным числом";g(s),L.error(s),console.log("Error:",s);return}try{u(!0),g(null);const s={...i,price:parseFloat(i.price)};console.log("FormData to send:",s),console.log("Submitting form with data:",s),console.log("Form Data before submission:",i),console.log("Client-side logging: Checking data to be sent to server..."),console.log("Values of all form fields before submission:"),Object.keys(s).forEach(p=>{console.log(`${p}: ${s[p]}`)}),console.log("Data to be sent:",s),a?(await H.put(`/games/${a.id}`,s),L.success("Игра успешно обновлена"),d()):(await H.post("/games",s),L.success("Игра успешно создана")),F(),d()}catch(s){const p=s.response?.data?.errors?.[0]?.msg||s.response?.data?.message||s.message||"Ошибка при сохранении игры";g(p),L.error(p),console.error("Error saving game:",s)}finally{u(!1)}},handleDelete:async n=>{if(window.confirm("Вы уверены, что хотите удалить эту игру?"))try{console.log("Deleting game with ID:",n),await H.delete(`/games/${n}`),L.success("Игра успешно удалена"),d()}catch(l){const s=l.response?.data?.message||l.message||"Ошибка при удалении игры";L.error(s),console.error("Error deleting game:",l)}}}},jt=()=>{const{games:t,loading:o,openDialog:r,selectedGame:u,page:b,rowsPerPage:g,formData:h,handleChangePage:f,handleChangeRowsPerPage:a,handleOpenDialog:c,handleCloseDialog:j,handleInputChange:I,handleSubmit:R,handleDelete:x}=it();return console.log("Loading state:",o),console.log("Games:",t),console.log("Open Dialog:",r),console.log("Selected Game:",u),console.log("Form Data:",h),console.log("Form Data:",typeof h.price),o?e.jsx(Pe,{}):e.jsxs(Be,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsxs(Ce,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[e.jsx(Ie,{variant:"h4",component:"h1",children:"Каталог игр"}),e.jsx(X,{variant:"contained",color:"primary",startIcon:e.jsx(ot,{}),onClick:()=>c(),children:"Добавить игру"})]}),e.jsx(lt,{games:t,page:b,rowsPerPage:g,onPageChange:f,onRowsPerPageChange:a,onEdit:c,onDelete:x}),e.jsx(rt,{open:r,onClose:j,formData:h,onInputChange:I,onSubmit:R,selectedGame:u})]})};export{jt as default};
