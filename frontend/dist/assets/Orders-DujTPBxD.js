import{j as e,h as W,r as o,B as f}from"./react-vendor-BB4BkCfL.js";import{h as O,L as k}from"./index-DpTN90_E.js";import{B as y,G as x,t as b,z,E as q,J as G,k as p,ac as v,ad as w,ae as D,a0 as K,y as U,a1 as I,a2 as L,a3 as j,a4 as s,a5 as E,I as $,af as H,ag as J,W as M,ah as N,l as F,N as _,C as Q}from"./mui-vendor-QnVK6N-v.js";import{aA as T}from"./vendor-Dh_iZ00o.js";import"./redux-vendor-56JQh752.js";const V=({searchTerm:r,selectedStatus:c,dateRange:t,onSearch:d,onStatusChange:l,onDateRangeChange:i})=>e.jsx(y,{sx:{mb:3},children:e.jsxs(x,{container:!0,spacing:2,children:[e.jsx(x,{item:!0,xs:12,sm:4,children:e.jsx(b,{fullWidth:!0,label:"Поиск",value:r,onChange:a=>d(a.target.value),placeholder:"Поиск по ID, email..."})}),e.jsx(x,{item:!0,xs:12,sm:2,children:e.jsxs(z,{fullWidth:!0,children:[e.jsx(q,{children:"Статус"}),e.jsxs(G,{value:c,onChange:a=>l(a.target.value),label:"Статус",children:[e.jsx(p,{value:"all",children:"Все"}),e.jsx(p,{value:"pending",children:"В обработке"}),e.jsx(p,{value:"completed",children:"Завершен"}),e.jsx(p,{value:"cancelled",children:"Отменен"})]})]})}),e.jsx(x,{item:!0,xs:12,sm:3,children:e.jsx(v,{dateAdapter:w,adapterLocale:T,children:e.jsx(D,{label:"Начальная дата",value:t.start?new Date(t.start):null,onChange:a=>i({...t,start:a?a.toISOString():""}),renderInput:a=>e.jsx(b,{...a,fullWidth:!0})})})}),e.jsx(x,{item:!0,xs:12,sm:3,children:e.jsx(v,{dateAdapter:w,adapterLocale:T,children:e.jsx(D,{label:"Конечная дата",value:t.end?new Date(t.end):null,onChange:a=>i({...t,end:a?a.toISOString():""}),renderInput:a=>e.jsx(b,{...a,fullWidth:!0})})})})]})}),X=({order:r,onStatusChange:c})=>{const[t,d]=W.useState(!1),l=a=>{switch(a){case"completed":return"success";case"pending":return"warning";case"cancelled":return"error";default:return"default"}},i=a=>{switch(a){case"completed":return"Завершен";case"pending":return"В обработке";case"cancelled":return"Отменен";default:return a}};return e.jsxs(e.Fragment,{children:[e.jsxs(j,{children:[e.jsx(s,{children:e.jsx($,{size:"small",onClick:()=>d(!t),children:t?e.jsx(H,{}):e.jsx(J,{})})}),e.jsx(s,{children:r.id}),e.jsx(s,{children:r.user.name}),e.jsx(s,{children:r.user.email}),e.jsx(s,{children:new Date(r.createdAt).toLocaleString("ru")}),e.jsx(s,{children:e.jsx(M,{label:i(r.status),color:l(r.status),onClick:()=>c(r.id,r.status)})}),e.jsxs(s,{children:[r.total.toFixed(2)," ₽"]})]}),e.jsx(j,{children:e.jsx(s,{style:{paddingBottom:0,paddingTop:0},colSpan:7,children:e.jsx(N,{in:t,timeout:"auto",unmountOnExit:!0,children:e.jsxs(y,{sx:{margin:1},children:[e.jsx(F,{variant:"h6",gutterBottom:!0,component:"div",children:"Детали заказа"}),e.jsxs(I,{size:"small",children:[e.jsx(L,{children:e.jsxs(j,{children:[e.jsx(s,{children:"Игра"}),e.jsx(s,{children:"Ключ"}),e.jsx(s,{children:"Цена"}),e.jsx(s,{children:"Количество"}),e.jsx(s,{children:"Сумма"})]})}),e.jsx(E,{children:r.items.map(a=>e.jsxs(j,{children:[e.jsx(s,{children:a.game.title}),e.jsx(s,{children:a.key}),e.jsxs(s,{children:[a.game.price.toFixed(2)," ₽"]}),e.jsx(s,{children:a.quantity}),e.jsxs(s,{children:[(a.game.price*a.quantity).toFixed(2)," ₽"]})]},a.id))})]})]})})})})]})},Y=({orders:r,onStatusChange:c})=>e.jsx(K,{component:U,children:e.jsxs(I,{children:[e.jsx(L,{children:e.jsxs(j,{children:[e.jsx(s,{}),e.jsx(s,{children:"ID"}),e.jsx(s,{children:"Имя"}),e.jsx(s,{children:"Email"}),e.jsx(s,{children:"Дата"}),e.jsx(s,{children:"Статус"}),e.jsx(s,{children:"Сумма"})]})}),e.jsx(E,{children:r.map(t=>e.jsx(X,{order:t,onStatusChange:c},t.id))})]})}),Z=({currentPage:r,totalPages:c,onPageChange:t})=>e.jsx(y,{sx:{display:"flex",justifyContent:"center",mt:3},children:e.jsx(_,{count:c,page:r,onChange:(d,l)=>t(l),color:"primary"})}),ee=()=>{const[r,c]=o.useState([]),[t,d]=o.useState(""),[l,i]=o.useState("all"),[a,m]=o.useState({start:"",end:""}),[u,h]=o.useState(1),[S,C]=o.useState(1),[A,B]=o.useState(!0),P=async()=>{try{const n=new URLSearchParams({page:u,status:l!=="all"?l:"",search:t,startDate:a.start,endDate:a.end}),g=await O.get(`/orders?${n}`);c(g.data.orders),C(g.data.totalPages)}catch(n){f.error("Ошибка при загрузке заказов"),console.error("Error fetching orders:",n)}finally{B(!1)}};return o.useEffect(()=>{P()},[u,l,t,a]),{orders:r,loading:A,searchTerm:t,selectedStatus:l,dateRange:a,currentPage:u,totalPages:S,handleSearch:n=>{d(n),h(1)},handleStatusChange:n=>{i(n),h(1)},handleDateRangeChange:n=>{m(n),h(1)},handlePageChange:n=>{h(n)},updateOrderStatus:async(n,g)=>{try{await O.put(`/orders/${n}/status`,{status:g}),f.success("Статус заказа обновлен"),P()}catch(R){f.error("Ошибка при обновлении статуса заказа"),console.error("Error updating order status:",R)}}}},he=()=>{const{orders:r,loading:c,searchTerm:t,selectedStatus:d,dateRange:l,currentPage:i,totalPages:a,handleSearch:m,handleStatusChange:u,handleDateRangeChange:h,handlePageChange:S,updateOrderStatus:C}=ee();return c?e.jsx(k,{}):e.jsxs(Q,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsx(F,{variant:"h4",component:"h1",sx:{mb:4},children:"Управление заказами"}),e.jsx(V,{searchTerm:t,selectedStatus:d,dateRange:l,onSearch:m,onStatusChange:u,onDateRangeChange:h}),e.jsx(Y,{orders:r,onStatusChange:C}),e.jsx(Z,{currentPage:i,totalPages:a,onPageChange:S})]})};export{he as default};
