import{c as N,t as v,r as d,B as n,j as e,u as S,b as U,v as y}from"./index-DwH2koU-.js";import{M as E}from"./Modal-CChU8ZLg.js";import{E as k}from"./eye-off-Cx_2MjK-.js";import{E as M}from"./eye-RRX6OTpV.js";import{R as D}from"./refresh-cw-DSLgdYKS.js";import{U as _}from"./user-Bv4nJ-yk.js";import{M as F}from"./mail-BUTMhzhL.js";import{P as R}from"./phone-DirJYGBP.js";import{M as G}from"./map-pin-CSTaY3jG.js";import{X as K}from"./x-BNpd7WcG.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=N("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=N("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),A=async()=>(await v.get("/api/game-keys/my")).data,$=async c=>(await v.get(`/api/game-keys/resend/${c}`)).data;function q(){const[c,s]=d.useState([]),[x,u]=d.useState(!0),[p,m]=d.useState({});d.useEffect(()=>{g()},[]);const g=async()=>{try{const a=await A();s(a)}catch{n.error("Ошибка при загрузке ключей")}finally{u(!1)}},o=a=>{m(t=>({...t,[a]:!t[a]}))},h=async a=>{try{await $(a),n.success("Данные для доступа отправлены на ваш email")}catch{n.error("Ошибка при отправке данных")}};return x?e.jsx("div",{className:"flex justify-center p-4",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):c.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"У вас пока нет цифровых ключей"})}):e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"px-4 py-5 sm:px-6",children:e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:"Мои цифровые ключи"})}),e.jsx("div",{className:"border-t border-gray-200",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:c.map(a=>e.jsx("li",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:a.game.title}),e.jsxs("div",{className:"mt-1",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Логин: ",a.login]}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Пароль: ",p[a._id]?a.password:"••••••••"]}),e.jsx("button",{onClick:()=>o(a._id),className:"ml-2 text-gray-400 hover:text-gray-600",children:p[a._id]?e.jsx(k,{className:"h-4 w-4"}):e.jsx(M,{className:"h-4 w-4"})})]})]})]}),e.jsxs("button",{onClick:()=>h(a._id),className:"flex items-center text-sm text-blue-600 hover:text-blue-800",children:[e.jsx(D,{className:"h-4 w-4 mr-1"}),"Отправить на email"]})]})},a._id))})})]})}function Y(){const c=S(),s=U(l=>l.auth.user),[x,u]=d.useState(!1),[p,m]=d.useState(!1),[g,o]=d.useState(null),[h,a]=d.useState(null),[t,f]=d.useState({name:(s==null?void 0:s.name)||"",email:(s==null?void 0:s.email)||"",phone:(s==null?void 0:s.phone)||"",address:(s==null?void 0:s.address)||"",avatar:(s==null?void 0:s.avatar)||""}),j=l=>{const{name:r,value:i}=l.target;f(b=>({...b,[r]:i}))},w=l=>{const r=l.target.files[0];if(r){if(r.size>5*1024*1024){n.error("Размер файла не должен превышать 5MB");return}if(!["image/jpeg","image/png","image/jpg"].includes(r.type)){n.error("Поддерживаются только форматы JPG и PNG");return}o(r);const i=new FileReader;i.onloadend=()=>{a(i.result)},i.readAsDataURL(r)}},P=async()=>{if(!g){n.error("Пожалуйста, выберите файл");return}if(!(s!=null&&s._id)){n.error("Ошибка: ID пользователя не найден");return}try{const l=new FormData;l.append("avatar",g);const r=await y.uploadAvatar(s._id,l);if(r&&r.avatar)f(i=>({...i,avatar:r.avatar})),c({type:"auth/updateUser",payload:{...s,avatar:r.avatar}}),n.success("Фото профиля успешно обновлено"),m(!1),o(null),a(null);else throw new Error("Не удалось получить URL загруженного аватара")}catch(l){console.error("Ошибка загрузки аватара:",l),n.error(l.message||"Ошибка при загрузке аватара")}},C=async l=>{var r,i;l.preventDefault();try{if(!(s!=null&&s._id)){n.error("Ошибка: ID пользователя не найден");return}await y.updateUser(s._id,t),c({type:"UPDATE_PROFILE",payload:t}),u(!1),n.success("Профиль успешно обновлен!")}catch(b){n.error("Ошибка при обновлении профиля: "+(((i=(r=b.response)==null?void 0:r.data)==null?void 0:i.message)||b.message))}};return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"relative h-48 bg-gradient-to-r from-blue-500 to-indigo-600",children:e.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-1/2",children:e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t.avatar?`${"http://localhost:3000/api".replace("/api","")}/api/uploads/${t.avatar.replace("uploads/","")}`:"/default-avatar.png",alt:"Profile",className:"w-32 h-32 rounded-full border-4 border-white object-cover"}),e.jsx("button",{onClick:()=>m(!0),className:"absolute bottom-0 right-0 bg-white rounded-full p-2 shadow-lg hover:bg-gray-100",title:"Изменить фото",children:e.jsx(L,{className:"w-5 h-5 text-gray-600"})})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 p-8",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold",children:t.name}),e.jsx("p",{className:"text-gray-600",children:t.email})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{className:"h-5 w-5 text-gray-400 mr-2"}),e.jsx("span",{children:t.name})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(F,{className:"h-5 w-5 text-gray-400 mr-2"}),e.jsx("span",{children:t.email})]}),t.phone&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(R,{className:"h-5 w-5 text-gray-400 mr-2"}),e.jsx("span",{children:t.phone})]}),t.address&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(G,{className:"h-5 w-5 text-gray-400 mr-2"}),e.jsx("span",{children:t.address})]})]}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:()=>u(!x),className:"w-full btn btn-primary",children:x?"Отменить":"Редактировать профиль"})})]})}),e.jsx("div",{className:"lg:col-span-2",children:x?e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Редактировать профиль"}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Имя"}),e.jsx("input",{type:"text",name:"name",value:t.name,onChange:j,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",name:"email",value:t.email,onChange:j,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Телефон"}),e.jsx("input",{type:"tel",name:"phone",value:t.phone,onChange:j,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Адрес"}),e.jsx("textarea",{name:"address",value:t.address,onChange:j,rows:3,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>u(!1),className:"btn btn-secondary",children:"Отмена"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Сохранить"})]})]})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"История заказов"}),e.jsx("p",{className:"text-gray-600",children:"История заказов пока пуста"})]})})]}),e.jsx("section",{children:e.jsx(q,{})})]}),e.jsx(E,{isOpen:p,onClose:()=>{m(!1),o(null),a(null)},title:"Загрузка фото профиля",children:e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"mb-4",children:h?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:h,alt:"Preview",className:"w-full h-64 object-cover rounded"}),e.jsx("button",{onClick:()=>{o(null),a(null)},className:"absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600",children:e.jsx(K,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-12 text-center",children:[e.jsx(I,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Нажмите для выбора файла или перетащите его сюда"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"PNG, JPG до 5MB"})]})}),e.jsx("input",{type:"file",accept:"image/*",onChange:w,className:"hidden",id:"photo-upload"}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{m(!1),o(null),a(null)},className:"btn btn-secondary",children:"Отмена"}),e.jsx("label",{htmlFor:"photo-upload",className:`btn ${h?"btn-secondary":"btn-primary"}`,children:"Выбрать файл"}),h&&e.jsx("button",{onClick:P,className:"btn btn-primary",children:"Загрузить"})]})]})})]})}export{Y as default};
