import{j as e,_ as z,P as N,$ as A,a0 as H,a1 as R,a2 as d,a3 as V,N as Q,h as L,I as O,a4 as _,aG as J,aH as K,a6 as X,a7 as Y,a8 as Z,r as b,w as ee,x as se,y as ae,l as k,a9 as le,g as P,C as te,B as re,m as ne,aI as oe}from"./ui-vendor-BekXbpvv.js";import{r as p}from"./react-vendor-CmdBDJ7C.js";import{h as E,Q as C,L as ie}from"./index-DbOi_nDC.js";import"./redux-vendor-D-krhjMU.js";import"./utils-upsvKRUO.js";const ce=i=>{switch(i){case"active":return"success";case"inactive":return"error";case"draft":return"warning";default:return"default"}},de=i=>{switch(i){case"active":return"Активна";case"inactive":return"Неактивна";case"draft":return"Черновик";default:return i}},ge=({games:i,page:c,rowsPerPage:a,onPageChange:r,onRowsPerPageChange:x,onEdit:g,onDelete:j})=>{const f=a-Math.min(a,i.length-c*a);return e.jsxs(e.Fragment,{children:[e.jsx(z,{component:N,children:e.jsxs(A,{children:[e.jsx(H,{children:e.jsxs(R,{children:[e.jsx(d,{children:"Название"}),e.jsx(d,{children:"Цена"}),e.jsx(d,{children:"Жанр"}),e.jsx(d,{children:"Платформа"}),e.jsx(d,{children:"Статус"}),e.jsx(d,{children:"Действия"})]})}),e.jsxs(V,{children:[i.slice(c*a,c*a+a).map(n=>e.jsxs(R,{children:[e.jsx(d,{children:n.title}),e.jsx(d,{children:n.price?`${n.price} ₽`:"Не указана"}),e.jsx(d,{children:n.genre||"Не указан"}),e.jsx(d,{children:n.platform||"Не указана"}),e.jsx(d,{children:e.jsx(Q,{label:de(n.status),color:ce(n.status),size:"small"})}),e.jsxs(d,{children:[e.jsx(L,{title:"Редактировать",children:e.jsx(O,{onClick:()=>g(n),size:"small",children:e.jsx(_,{})})}),e.jsx(L,{title:"Удалить",children:e.jsx(O,{onClick:()=>j(n.id),size:"small",color:"error",children:e.jsx(J,{})})})]})]},n.id)),f>0&&e.jsx(R,{style:{height:53*f},children:e.jsx(d,{colSpan:6})})]})]})}),e.jsx(K,{component:"div",count:i.length,page:c,onPageChange:r,rowsPerPage:a,onRowsPerPageChange:x,labelRowsPerPage:"Строк на странице:",labelDisplayedRows:({from:n,to:m,count:v})=>`${n}-${m} из ${v!==-1?v:`более чем ${m}`}`})]})},ue=({open:i,onClose:c,formData:a,onInputChange:r,onSubmit:x,selectedGame:g})=>e.jsxs(X,{open:i,onClose:c,maxWidth:"md",fullWidth:!0,children:[e.jsx(Y,{children:g?"Редактировать игру":"Добавить новую игру"}),e.jsxs("form",{onSubmit:x,children:[e.jsxs(Z,{children:[e.jsx(b,{fullWidth:!0,margin:"normal",label:"Название",name:"title",value:a.title,onChange:r,required:!0}),e.jsx(b,{fullWidth:!0,margin:"normal",label:"Описание",name:"description",value:a.description,onChange:r,multiline:!0,rows:4,required:!0}),e.jsx(b,{fullWidth:!0,margin:"normal",label:"Цена",name:"price",type:"number",value:a.price,onChange:r,required:!0}),e.jsx(b,{fullWidth:!0,margin:"normal",label:"Жанр",name:"genre",value:a.genre,onChange:r,required:!0}),e.jsx(b,{fullWidth:!0,margin:"normal",label:"Платформа",name:"platform",value:a.platform,onChange:r,required:!0}),e.jsx(b,{fullWidth:!0,margin:"normal",label:"Издатель",name:"publisher",value:a.publisher,onChange:r,required:!0}),e.jsx(b,{fullWidth:!0,margin:"normal",label:"URL изображения",name:"imageUrl",value:a.imageUrl,onChange:r}),e.jsxs(ee,{fullWidth:!0,margin:"normal",children:[e.jsx(se,{children:"Статус"}),e.jsxs(ae,{name:"status",value:a.status,onChange:r,label:"Статус",children:[e.jsx(k,{value:"active",children:"Активна"}),e.jsx(k,{value:"inactive",children:"Неактивна"})]})]})]}),e.jsxs(le,{children:[e.jsx(P,{onClick:c,children:"Отмена"}),e.jsx(P,{type:"submit",variant:"contained",color:"primary",children:g?"Сохранить":"Добавить"})]})]})]}),he=()=>{const[i,c]=p.useState([]),[a,r]=p.useState(!0),[x,g]=p.useState(null),[j,f]=p.useState(!1),[n,m]=p.useState(null),[v,w]=p.useState(0),[T,$]=p.useState(10),[h,S]=p.useState({title:"",description:"",price:"",genre:"",platform:"",publisher:"",imageUrl:"",status:"active"}),y=async()=>{var s,l;console.log("Fetching games...");try{r(!0),g(null);const o=await E.get("/games");if(console.log("Response:",o.data),o.data.success)c(o.data.data||[]);else throw new Error(o.data.message||"Failed to fetch games")}catch(o){const u=((l=(s=o.response)==null?void 0:s.data)==null?void 0:l.message)||o.message||"Ошибка при загрузке игр";g(u),C.error(u),console.error("Error fetching games:",o),c([])}finally{r(!1)}};p.useEffect(()=>{y()},[]);const q=(s,l)=>{console.log("Changing page to:",l),w(l)},M=s=>{const l=parseInt(s.target.value,10);console.log("Changing rows per page to:",l),$(l),w(0)},B=(s=null)=>{var l;console.log("Opening dialog for game:",s),s?(S({title:s.title||"",description:s.description||"",price:((l=s.price)==null?void 0:l.toString())||"",genre:s.genre||"",platform:s.platform||"",publisher:s.publisher||"",imageUrl:s.imageUrl||"",status:s.status||"active"}),m(s)):(S({title:"",description:"",price:"",genre:"",platform:"",publisher:"",imageUrl:"",status:"active"}),m(null)),f(!0)},W=()=>{console.log("Closing dialog"),f(!1),m(null),S({title:"",description:"",price:"",genre:"",platform:"",publisher:"",imageUrl:"",status:"active"})};return{games:i,loading:a,error:x,openDialog:j,selectedGame:n,formData:h,page:v,rowsPerPage:T,handleChangePage:q,handleChangeRowsPerPage:M,handleOpenDialog:B,handleCloseDialog:W,handleInputChange:s=>{const{name:l,value:o}=s.target;console.log(`Changing input ${l} to:`,o),S(u=>({...u,[l]:o}))},handleSubmit:async s=>{var o,u,F,G,I,U;s.preventDefault(),console.log("Submitting form with data:",h),console.log("Form Data before submission:",h),console.log("Values of all form fields before submission:"),Object.keys(h).forEach(t=>{console.log(`${t}: ${h[t]}`)}),console.log("Client-side logging: Checking data to be sent to server..."),console.log("Data to be sent:",h);const l=parseFloat(h.price);if(isNaN(l)||l<=0){const t="Цена должна быть положительным числом";g(t),C.error(t),console.log("Error:",t);return}try{r(!0),g(null);const t={...h,price:parseFloat(h.price)};console.log("FormData to send:",t),console.log("Submitting form with data:",t),console.log("Form Data before submission:",h),console.log("Client-side logging: Checking data to be sent to server..."),console.log("Values of all form fields before submission:"),Object.keys(t).forEach(D=>{console.log(`${D}: ${t[D]}`)}),console.log("Data to be sent:",t),n?(await E.put(`/games/${n.id}`,t),C.success("Игра успешно обновлена"),y()):(await E.post("/games",t),C.success("Игра успешно создана")),W(),y()}catch(t){const D=((G=(F=(u=(o=t.response)==null?void 0:o.data)==null?void 0:u.errors)==null?void 0:F[0])==null?void 0:G.msg)||((U=(I=t.response)==null?void 0:I.data)==null?void 0:U.message)||t.message||"Ошибка при сохранении игры";g(D),C.error(D),console.error("Error saving game:",t)}finally{r(!1)}},handleDelete:async s=>{var l,o;if(window.confirm("Вы уверены, что хотите удалить эту игру?"))try{console.log("Deleting game with ID:",s),await E.delete(`/games/${s}`),C.success("Игра успешно удалена"),y()}catch(u){const F=((o=(l=u.response)==null?void 0:l.data)==null?void 0:o.message)||u.message||"Ошибка при удалении игры";C.error(F),console.error("Error deleting game:",u)}}}},De=()=>{const{games:i,loading:c,openDialog:a,selectedGame:r,page:x,rowsPerPage:g,formData:j,handleChangePage:f,handleChangeRowsPerPage:n,handleOpenDialog:m,handleCloseDialog:v,handleInputChange:w,handleSubmit:T,handleDelete:$}=he();return console.log("Loading state:",c),console.log("Games:",i),console.log("Open Dialog:",a),console.log("Selected Game:",r),console.log("Form Data:",j),console.log("Form Data:",typeof j.price),c?e.jsx(ie,{}):e.jsxs(te,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsxs(re,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[e.jsx(ne,{variant:"h4",component:"h1",children:"Каталог игр"}),e.jsx(P,{variant:"contained",color:"primary",startIcon:e.jsx(oe,{}),onClick:()=>m(),children:"Добавить игру"})]}),e.jsx(ge,{games:i,page:x,rowsPerPage:g,onPageChange:f,onRowsPerPageChange:n,onEdit:m,onDelete:$}),e.jsx(ue,{open:a,onClose:v,formData:j,onInputChange:w,onSubmit:T,selectedGame:r})]})};export{De as default};
