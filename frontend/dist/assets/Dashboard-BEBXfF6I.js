import{j as e,L as A,r as j,B as M}from"./react-vendor-BB4BkCfL.js";import{h as R,L as $}from"./index-DpTN90_E.js";import{Q as p,B as c,U as v,l,m as N,G as i,X as U,g as W,Y as X,Z as Y,O as Q,_ as Z,C as _,h as q,I as F,$ as H,s as J}from"./mui-vendor-QnVK6N-v.js";import{ar as E,as as P,at as G,au as K,av as O,aw as T,ax as V,ay as ee,az as se}from"./vendor-Dh_iZ00o.js";import"./redux-vendor-56JQh752.js";const ae=s=>{switch(s){case"users":return e.jsx(Z,{sx:{fontSize:40}});case"orders":return e.jsx(Q,{sx:{fontSize:40}});case"catalog":return e.jsx(Y,{sx:{fontSize:40}});case"keys":return e.jsx(X,{sx:{fontSize:40}});default:return null}},te=({module:s})=>{const{title:r,description:a,icon:d,path:x,color:t,stats:o}=s;return e.jsxs(p,{sx:{height:"100%",display:"flex",flexDirection:"column",position:"relative","&:hover":{boxShadow:6}},children:[e.jsx(c,{sx:{position:"absolute",top:0,right:0,width:"100px",height:"100px",background:t,opacity:.1,borderRadius:"0 0 0 100%"}}),e.jsxs(v,{sx:{flexGrow:1},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(c,{sx:{color:t,mr:2},children:ae(d)}),e.jsx(l,{variant:"h5",component:"h2",children:r})]}),e.jsx(l,{variant:"body2",color:"text.secondary",sx:{mb:2},children:a}),e.jsx(N,{sx:{my:2}}),e.jsx(i,{container:!0,spacing:2,children:o.map((h,u)=>e.jsxs(i,{item:!0,xs:4,children:[e.jsx(l,{variant:"h6",component:"div",sx:{color:t},children:h.value}),e.jsx(l,{variant:"caption",color:"text.secondary",children:h.label})]},u))})]}),e.jsx(U,{children:e.jsx(W,{component:A,to:x,size:"small",color:"primary",sx:{ml:"auto"},children:"Перейти"})})]})},re=({stats:s})=>{const r=[{name:"Всего",value:s.orders.total},{name:"В обработке",value:s.orders.pending},{name:"Выполнено",value:s.orders.total-s.orders.pending}],a=[{name:"Всего",value:s.games.total},{name:"Активные",value:s.games.active},{name:"Нет в наличии",value:s.games.outOfStock}];return e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(p,{children:e.jsxs(v,{children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Статистика заказов"}),e.jsx(c,{sx:{width:"100%",height:300},children:e.jsx(E,{children:e.jsxs(P,{data:r,children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"name"}),e.jsx(O,{}),e.jsx(T,{}),e.jsx(V,{dataKey:"value",fill:"#4caf50"})]})})})]})})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(p,{children:e.jsxs(v,{children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Статистика игр"}),e.jsx(c,{sx:{width:"100%",height:300},children:e.jsx(E,{children:e.jsxs(ee,{data:a,children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"name"}),e.jsx(O,{}),e.jsx(T,{}),e.jsx(se,{type:"monotone",dataKey:"value",stroke:"#ff9800",strokeWidth:2})]})})})]})})})]})},oe=()=>{var u,g,f,y,b,k,S,w,C,I,B,D;const[s,r]=j.useState({users:{total:0,newToday:0,activeNow:0},orders:{total:0,pending:0,revenue:0},games:{total:0,active:0,outOfStock:0},keys:{total:0,available:0,sold:0}}),[a,d]=j.useState(!0),[x,t]=j.useState(null),o=async()=>{var m,L;try{const n=await R.get("/dashboard/stats");if(!n.data.success)throw new Error(n.data.message||"Ошибка при загрузке статистики");r(n.data.data),t(null)}catch(n){const z=((L=(m=n.response)==null?void 0:m.data)==null?void 0:L.message)||n.message||"Ошибка при загрузке статистики";t(z),M.error(z),console.error("Error fetching dashboard stats:",n)}finally{d(!1)}};j.useEffect(()=>{o();const m=setInterval(o,5*60*1e3);return()=>clearInterval(m)},[]);const h=[{title:"Пользователи",description:"Управление пользователями системы",icon:"users",path:"/admin/users",color:"#2196f3",stats:[{label:"Всего",value:((u=s.users)==null?void 0:u.total)||0},{label:"Новых сегодня",value:((g=s.users)==null?void 0:g.newToday)||0},{label:"Активны сейчас",value:((f=s.users)==null?void 0:f.activeNow)||0}]},{title:"Заказы",description:"Просмотр и управление заказами",icon:"orders",path:"/admin/orders",color:"#4caf50",stats:[{label:"Всего",value:((y=s.orders)==null?void 0:y.total)||0},{label:"В обработке",value:((b=s.orders)==null?void 0:b.pending)||0},{label:"Выручка",value:`${((k=s.orders)==null?void 0:k.revenue)||0} ₽`}]},{title:"Игры",description:"Управление каталогом игр",icon:"games",path:"/admin/catalog",color:"#ff9800",stats:[{label:"Всего",value:((S=s.games)==null?void 0:S.total)||0},{label:"Активных",value:((w=s.games)==null?void 0:w.active)||0},{label:"Нет в наличии",value:((C=s.games)==null?void 0:C.outOfStock)||0}]},{title:"Ключи",description:"Управление ключами активации",icon:"keys",path:"/admin/keys",color:"#e91e63",stats:[{label:"Всего",value:((I=s.keys)==null?void 0:I.total)||0},{label:"Доступно",value:((B=s.keys)==null?void 0:B.available)||0},{label:"Продано",value:((D=s.keys)==null?void 0:D.sold)||0}]}];return{stats:s,loading:a,error:x,adminModules:h,refresh:o}},xe=()=>{const{stats:s,loading:r,error:a,adminModules:d,refreshStats:x}=oe();return r?e.jsx($,{}):e.jsxs(_,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",mb:4},children:[e.jsx(l,{variant:"h4",component:"h1",sx:{flexGrow:1},children:"Панель управления"}),e.jsx(q,{title:"Обновить статистику",children:e.jsx(F,{onClick:x,color:"primary",children:e.jsx(H,{})})})]}),a&&e.jsx(J,{severity:"error",sx:{mb:3},children:a}),e.jsx(i,{container:!0,spacing:3,sx:{mb:4},children:d.map((t,o)=>e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsx(te,{module:t})},o))}),e.jsx(re,{stats:s})]})};export{xe as default};
