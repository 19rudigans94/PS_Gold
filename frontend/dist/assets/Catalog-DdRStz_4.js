import{j as e,r as p,B as b}from"./react-vendor-DJDP48A3.js";import{h as F,L as z}from"./index-BHnZzIva.js";import{a0 as A,y as N,a1 as V,a2 as H,a3 as W,a4 as d,a5 as J,W as K,h as I,I as L,a6 as Q,ai as X,aj as Y,a8 as Z,a9 as _,aa as ee,t as C,z as se,E as ae,J as le,k as O,ab as te,g as $,C as re,B as ne,l as oe,ak as ie}from"./mui-vendor-Dc8Krwhl.js";import"./vendor-CNMAvAG4.js";import"./redux-vendor-DRW7Cx4S.js";const ce=i=>{switch(i){case"active":return"success";case"inactive":return"error";case"draft":return"warning";default:return"default"}},de=i=>{switch(i){case"active":return"Активна";case"inactive":return"Неактивна";case"draft":return"Черновик";default:return i}},ge=({games:i,page:c,rowsPerPage:a,onPageChange:r,onRowsPerPageChange:x,onEdit:g,onDelete:j})=>{const f=a-Math.min(a,i.length-c*a);return e.jsxs(e.Fragment,{children:[e.jsx(A,{component:N,children:e.jsxs(V,{children:[e.jsx(H,{children:e.jsxs(W,{children:[e.jsx(d,{children:"Название"}),e.jsx(d,{children:"Цена"}),e.jsx(d,{children:"Жанр"}),e.jsx(d,{children:"Платформа"}),e.jsx(d,{children:"Статус"}),e.jsx(d,{children:"Действия"})]})}),e.jsxs(J,{children:[i.slice(c*a,c*a+a).map(n=>e.jsxs(W,{children:[e.jsx(d,{children:n.title}),e.jsx(d,{children:n.price?`${n.price} ₽`:"Не указана"}),e.jsx(d,{children:n.genre||"Не указан"}),e.jsx(d,{children:n.platform||"Не указана"}),e.jsx(d,{children:e.jsx(K,{label:de(n.status),color:ce(n.status),size:"small"})}),e.jsxs(d,{children:[e.jsx(I,{title:"Редактировать",children:e.jsx(L,{onClick:()=>g(n),size:"small",children:e.jsx(Q,{})})}),e.jsx(I,{title:"Удалить",children:e.jsx(L,{onClick:()=>j(n.id),size:"small",color:"error",children:e.jsx(X,{})})})]})]},n.id)),f>0&&e.jsx(W,{style:{height:53*f},children:e.jsx(d,{colSpan:6})})]})]})}),e.jsx(Y,{component:"div",count:i.length,page:c,onPageChange:r,rowsPerPage:a,onRowsPerPageChange:x,labelRowsPerPage:"Строк на странице:",labelDisplayedRows:({from:n,to:m,count:v})=>`${n}-${m} из ${v!==-1?v:`более чем ${m}`}`})]})},ue=({open:i,onClose:c,formData:a,onInputChange:r,onSubmit:x,selectedGame:g})=>e.jsxs(Z,{open:i,onClose:c,maxWidth:"md",fullWidth:!0,children:[e.jsx(_,{children:g?"Редактировать игру":"Добавить новую игру"}),e.jsxs("form",{onSubmit:x,children:[e.jsxs(ee,{children:[e.jsx(C,{fullWidth:!0,margin:"normal",label:"Название",name:"title",value:a.title,onChange:r,required:!0}),e.jsx(C,{fullWidth:!0,margin:"normal",label:"Описание",name:"description",value:a.description,onChange:r,multiline:!0,rows:4,required:!0}),e.jsx(C,{fullWidth:!0,margin:"normal",label:"Цена",name:"price",type:"number",value:a.price,onChange:r,required:!0}),e.jsx(C,{fullWidth:!0,margin:"normal",label:"Жанр",name:"genre",value:a.genre,onChange:r,required:!0}),e.jsx(C,{fullWidth:!0,margin:"normal",label:"Платформа",name:"platform",value:a.platform,onChange:r,required:!0}),e.jsx(C,{fullWidth:!0,margin:"normal",label:"Издатель",name:"publisher",value:a.publisher,onChange:r,required:!0}),e.jsx(C,{fullWidth:!0,margin:"normal",label:"URL изображения",name:"imageUrl",value:a.imageUrl,onChange:r}),e.jsxs(se,{fullWidth:!0,margin:"normal",children:[e.jsx(ae,{children:"Статус"}),e.jsxs(le,{name:"status",value:a.status,onChange:r,label:"Статус",children:[e.jsx(O,{value:"active",children:"Активна"}),e.jsx(O,{value:"inactive",children:"Неактивна"})]})]})]}),e.jsxs(te,{children:[e.jsx($,{onClick:c,children:"Отмена"}),e.jsx($,{type:"submit",variant:"contained",color:"primary",children:g?"Сохранить":"Добавить"})]})]})]}),he=()=>{const[i,c]=p.useState([]),[a,r]=p.useState(!0),[x,g]=p.useState(null),[j,f]=p.useState(!1),[n,m]=p.useState(null),[v,S]=p.useState(0),[T,R]=p.useState(10),[h,w]=p.useState({title:"",description:"",price:"",genre:"",platform:"",publisher:"",imageUrl:"",status:"active"}),y=async()=>{var s,l;console.log("Fetching games...");try{r(!0),g(null);const o=await F.get("/games");if(console.log("Response:",o.data),o.data.success)c(o.data.data||[]);else throw new Error(o.data.message||"Failed to fetch games")}catch(o){const u=((l=(s=o.response)==null?void 0:s.data)==null?void 0:l.message)||o.message||"Ошибка при загрузке игр";g(u),b.error(u),console.error("Error fetching games:",o),c([])}finally{r(!1)}};p.useEffect(()=>{y()},[]);const q=(s,l)=>{console.log("Changing page to:",l),S(l)},B=s=>{const l=parseInt(s.target.value,10);console.log("Changing rows per page to:",l),R(l),S(0)},M=(s=null)=>{var l;console.log("Opening dialog for game:",s),s?(w({title:s.title||"",description:s.description||"",price:((l=s.price)==null?void 0:l.toString())||"",genre:s.genre||"",platform:s.platform||"",publisher:s.publisher||"",imageUrl:s.imageUrl||"",status:s.status||"active"}),m(s)):(w({title:"",description:"",price:"",genre:"",platform:"",publisher:"",imageUrl:"",status:"active"}),m(null)),f(!0)},P=()=>{console.log("Closing dialog"),f(!1),m(null),w({title:"",description:"",price:"",genre:"",platform:"",publisher:"",imageUrl:"",status:"active"})};return{games:i,loading:a,error:x,openDialog:j,selectedGame:n,formData:h,page:v,rowsPerPage:T,handleChangePage:q,handleChangeRowsPerPage:B,handleOpenDialog:M,handleCloseDialog:P,handleInputChange:s=>{const{name:l,value:o}=s.target;console.log(`Changing input ${l} to:`,o),w(u=>({...u,[l]:o}))},handleSubmit:async s=>{var o,u,E,k,G,U;s.preventDefault(),console.log("Submitting form with data:",h),console.log("Form Data before submission:",h),console.log("Values of all form fields before submission:"),Object.keys(h).forEach(t=>{console.log(`${t}: ${h[t]}`)}),console.log("Client-side logging: Checking data to be sent to server..."),console.log("Data to be sent:",h);const l=parseFloat(h.price);if(isNaN(l)||l<=0){const t="Цена должна быть положительным числом";g(t),b.error(t),console.log("Error:",t);return}try{r(!0),g(null);const t={...h,price:parseFloat(h.price)};console.log("FormData to send:",t),console.log("Submitting form with data:",t),console.log("Form Data before submission:",h),console.log("Client-side logging: Checking data to be sent to server..."),console.log("Values of all form fields before submission:"),Object.keys(t).forEach(D=>{console.log(`${D}: ${t[D]}`)}),console.log("Data to be sent:",t),n?(await F.put(`/games/${n.id}`,t),b.success("Игра успешно обновлена"),y()):(await F.post("/games",t),b.success("Игра успешно создана")),P(),y()}catch(t){const D=((k=(E=(u=(o=t.response)==null?void 0:o.data)==null?void 0:u.errors)==null?void 0:E[0])==null?void 0:k.msg)||((U=(G=t.response)==null?void 0:G.data)==null?void 0:U.message)||t.message||"Ошибка при сохранении игры";g(D),b.error(D),console.error("Error saving game:",t)}finally{r(!1)}},handleDelete:async s=>{var l,o;if(window.confirm("Вы уверены, что хотите удалить эту игру?"))try{console.log("Deleting game with ID:",s),await F.delete(`/games/${s}`),b.success("Игра успешно удалена"),y()}catch(u){const E=((o=(l=u.response)==null?void 0:l.data)==null?void 0:o.message)||u.message||"Ошибка при удалении игры";b.error(E),console.error("Error deleting game:",u)}}}},De=()=>{const{games:i,loading:c,openDialog:a,selectedGame:r,page:x,rowsPerPage:g,formData:j,handleChangePage:f,handleChangeRowsPerPage:n,handleOpenDialog:m,handleCloseDialog:v,handleInputChange:S,handleSubmit:T,handleDelete:R}=he();return console.log("Loading state:",c),console.log("Games:",i),console.log("Open Dialog:",a),console.log("Selected Game:",r),console.log("Form Data:",j),console.log("Form Data:",typeof j.price),c?e.jsx(z,{}):e.jsxs(re,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsxs(ne,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[e.jsx(oe,{variant:"h4",component:"h1",children:"Каталог игр"}),e.jsx($,{variant:"contained",color:"primary",startIcon:e.jsx(ie,{}),onClick:()=>m(),children:"Добавить игру"})]}),e.jsx(ge,{games:i,page:x,rowsPerPage:g,onPageChange:f,onRowsPerPageChange:n,onEdit:m,onDelete:R}),e.jsx(ue,{open:a,onClose:v,formData:j,onInputChange:S,onSubmit:T,selectedGame:r})]})};export{De as default};
