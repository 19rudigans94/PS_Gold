import{j as e,B as q,G as C,r as T,w as P,x as R,y as M,l as p,_ as V,P as z,$ as J,a0 as K,a1 as G,a2 as o,a3 as X,N as I,h as O,I as $,a4 as Y,a5 as Z,M as ee,a6 as se,a7 as ae,a8 as te,a9 as ne,g as A,E as re,C as le,m as oe}from"./ui-vendor-BekXbpvv.js";import{b as W,r as m}from"./react-vendor-CmdBDJ7C.js";import{h as w,Q as b,L as ie}from"./index-DbOi_nDC.js";import"./redux-vendor-D-krhjMU.js";import"./utils-upsvKRUO.js";const ce=({searchTerm:s,selectedRole:l,onSearch:t,onRoleChange:c})=>e.jsx(q,{sx:{mb:3},children:e.jsxs(C,{container:!0,spacing:2,children:[e.jsx(C,{item:!0,xs:12,sm:8,children:e.jsx(T,{fullWidth:!0,label:"Поиск",value:s,onChange:a=>t(a.target.value),placeholder:"Поиск по имени, email..."})}),e.jsx(C,{item:!0,xs:12,sm:4,children:e.jsxs(P,{fullWidth:!0,children:[e.jsx(R,{children:"Роль"}),e.jsxs(M,{value:l,onChange:a=>c(a.target.value),label:"Роль",children:[e.jsx(p,{value:"all",children:"Все"}),e.jsx(p,{value:"user",children:"Пользователь"}),e.jsx(p,{value:"admin",children:"Администратор"})]})]})})]})}),de=({user:s,onStatusChange:l,onRoleChange:t,onEdit:c})=>{const[a,j]=W.useState(null),d=u=>{j(u.currentTarget)},h=()=>{j(null)},g=u=>{l(s.id,u),h()},S=u=>{t(s.id,u),h()};return e.jsxs(G,{children:[e.jsx(o,{children:s.name}),e.jsx(o,{children:s.email}),e.jsx(o,{children:e.jsx(I,{label:s.role==="admin"?"Администратор":"Пользователь",color:s.role==="admin"?"primary":"default"})}),e.jsx(o,{children:e.jsx(I,{label:s.status==="active"?"Активен":"Заблокирован",color:s.status==="active"?"success":"error"})}),e.jsx(o,{children:new Date(s.registeredAt).toLocaleDateString("ru")}),e.jsx(o,{children:new Date(s.lastLogin).toLocaleDateString("ru")}),e.jsxs(o,{children:[e.jsx(O,{title:"Редактировать",children:e.jsx($,{onClick:()=>c(s),children:e.jsx(Y,{})})}),e.jsx(O,{title:"Действия",children:e.jsx($,{onClick:d,children:e.jsx(Z,{})})}),e.jsxs(ee,{anchorEl:a,open:!!a,onClose:h,children:[e.jsx(p,{onClick:()=>g(s.status==="active"?"blocked":"active"),children:s.status==="active"?"Заблокировать":"Разблокировать"}),e.jsx(p,{onClick:()=>S(s.role==="admin"?"user":"admin"),children:s.role==="admin"?"Сделать пользователем":"Сделать администратором"})]})]})]})},he=({users:s,onStatusChange:l,onRoleChange:t,onEdit:c})=>e.jsx(V,{component:z,children:e.jsxs(J,{children:[e.jsx(K,{children:e.jsxs(G,{children:[e.jsx(o,{children:"Имя"}),e.jsx(o,{children:"Email"}),e.jsx(o,{children:"Роль"}),e.jsx(o,{children:"Статус"}),e.jsx(o,{children:"Дата регистрации"}),e.jsx(o,{children:"Последний вход"}),e.jsx(o,{children:"Действия"})]})}),e.jsx(X,{children:s.map(a=>e.jsx(de,{user:a,onStatusChange:l,onRoleChange:t,onEdit:c},a.id))})]})}),ue=({open:s,onClose:l,user:t,onSubmit:c})=>{const[a,j]=W.useState({name:"",email:"",role:"user",status:"active"});W.useEffect(()=>{t&&j({name:t.name,email:t.email,role:t.role,status:t.status})},[t]);const d=g=>{const{name:S,value:u}=g.target;j(x=>({...x,[S]:u}))},h=g=>{g.preventDefault(),c(a)};return e.jsxs(se,{open:s,onClose:l,maxWidth:"sm",fullWidth:!0,children:[e.jsx(ae,{children:t?"Редактировать пользователя":"Добавить пользователя"}),e.jsxs("form",{onSubmit:h,children:[e.jsx(te,{children:e.jsxs(C,{container:!0,spacing:2,children:[e.jsx(C,{item:!0,xs:12,children:e.jsx(T,{fullWidth:!0,label:"Имя",name:"name",value:a.name,onChange:d,required:!0})}),e.jsx(C,{item:!0,xs:12,children:e.jsx(T,{fullWidth:!0,label:"Email",name:"email",type:"email",value:a.email,onChange:d,required:!0})}),e.jsx(C,{item:!0,xs:12,sm:6,children:e.jsxs(P,{fullWidth:!0,children:[e.jsx(R,{children:"Роль"}),e.jsxs(M,{name:"role",value:a.role,onChange:d,label:"Роль",children:[e.jsx(p,{value:"user",children:"Пользователь"}),e.jsx(p,{value:"admin",children:"Администратор"})]})]})}),e.jsx(C,{item:!0,xs:12,sm:6,children:e.jsxs(P,{fullWidth:!0,children:[e.jsx(R,{children:"Статус"}),e.jsxs(M,{name:"status",value:a.status,onChange:d,label:"Статус",children:[e.jsx(p,{value:"active",children:"Активен"}),e.jsx(p,{value:"blocked",children:"Заблокирован"})]})]})})]})}),e.jsxs(ne,{children:[e.jsx(A,{onClick:l,children:"Отмена"}),e.jsx(A,{type:"submit",variant:"contained",color:"primary",children:t?"Сохранить":"Добавить"})]})]})]})},xe=({currentPage:s,totalPages:l,onPageChange:t})=>e.jsx(q,{sx:{display:"flex",justifyContent:"center",mt:3},children:e.jsx(re,{count:l,page:s,onChange:(c,a)=>t(a),color:"primary"})}),me=()=>{const[s,l]=m.useState([]),[t,c]=m.useState(""),[a,j]=m.useState(""),[d,h]=m.useState(1),[g,S]=m.useState(1),[u,x]=m.useState(!0),[v,U]=m.useState(null),[D,F]=m.useState(!1),[L,k]=m.useState(null),y=async()=>{var r,f;try{x(!0),U(null);const i=new URLSearchParams({page:d,limit:10});a&&i.append("role",a),t&&i.append("search",t);const n=await w.get(`/users?${i}`);if(!n.data.success)throw new Error(n.data.message||"Failed to fetch users");l(n.data.data),S(Math.ceil(n.data.total/10))}catch(i){const n=((f=(r=i.response)==null?void 0:r.data)==null?void 0:f.message)||i.message||"Ошибка при загрузке пользователей";U(n),b.error(n),console.error("Error fetching users:",i)}finally{x(!1)}};m.useEffect(()=>{y()},[d,a,t]);const _=r=>{c(r),h(1)},H=r=>{j(r==="all"?"":r),h(1)},N=r=>{h(r)},Q=(r=null)=>{k(r),F(!0)},B=()=>{k(null),F(!1)};return{users:s,loading:u,error:v,searchTerm:t,selectedRole:a,currentPage:d,totalPages:g,openDialog:D,selectedUser:L,handleSearch:_,handleRoleChange:H,handlePageChange:N,handleOpenDialog:Q,handleCloseDialog:B,handleUpdateUser:async r=>{var f,i;try{x(!0);const n=await w.put(`/users/${L.id}`,r);if(!n.data.success)throw new Error(n.data.message||"Failed to update user");b.success("Пользователь успешно обновлен"),B(),y()}catch(n){const E=((i=(f=n.response)==null?void 0:f.data)==null?void 0:i.message)||n.message||"Ошибка при обновлении пользователя";b.error(E),console.error("Error updating user:",n)}finally{x(!1)}},handleDeleteUser:async r=>{var f,i;if(window.confirm("Вы уверены, что хотите удалить этого пользователя?"))try{x(!0);const n=await w.delete(`/users/${r}`);if(!n.data.success)throw new Error(n.data.message||"Failed to delete user");b.success("Пользователь успешно удален"),y()}catch(n){const E=((i=(f=n.response)==null?void 0:f.data)==null?void 0:i.message)||n.message||"Ошибка при удалении пользователя";b.error(E),console.error("Error deleting user:",n)}finally{x(!1)}},refresh:y}},ve=()=>{const{users:s,loading:l,searchTerm:t,selectedRole:c,currentPage:a,totalPages:j,openDialog:d,selectedUser:h,handleSearch:g,handleRoleChange:S,handlePageChange:u,handleOpenDialog:x,handleCloseDialog:v,updateUserStatus:U,updateUserRole:D}=me();return l?e.jsx(ie,{}):e.jsxs(le,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsx(oe,{variant:"h4",component:"h1",sx:{mb:4},children:"Управление пользователями"}),e.jsx(ce,{searchTerm:t,selectedRole:c,onSearch:g,onRoleChange:S}),e.jsx(he,{users:s,onStatusChange:U,onRoleChange:D,onEdit:x}),e.jsx(xe,{currentPage:a,totalPages:j,onPageChange:u}),e.jsx(ue,{open:d,onClose:v,user:h,onSubmit:v})]})};export{ve as default};
